<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ü–æ–π–º–∞–π –ò–Ω—Å–∞—Ä–∞ ‚Äî –º–∏–Ω–∏-–∏–≥—Ä–∞</title>
<style>
  :root{
    --bg:#fffbf0;
    --card:#ffffff;
    --accent:#ff6b6b;
    --accent2:#ffd93d;
    --muted:#6b6b6b;
    --shadow: 0 8px 30px rgba(18,18,18,0.08);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;
    background:linear-gradient(180deg,#fff7f0 0%, #fffefc 60%);
    color:#222;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
  }
  .wrap{
    width:100%;
    max-width:1100px;
    background:var(--card);
    border-radius:18px;
    padding:20px;
    box-shadow:var(--shadow);
  }
  header{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
  .logo{
    width:64px;height:64px;border-radius:12px;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    display:flex;align-items:center;justify-content:center;
    color:white;font-weight:700;font-size:20px
  }
  h1{margin:0;font-size:20px}
  p.lead{margin:4px 0 0;color:var(--muted)}

  .controls{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px}
  .card{
    background:linear-gradient(180deg,#ffffff,#fffdf7);
    padding:12px;border-radius:12px;box-shadow:var(--shadow);
  }
  button{
    padding:10px 14px;border-radius:10px;border:0;
    background:var(--accent);color:white;font-weight:700;cursor:pointer
  }
  button.secondary{background:transparent;color:var(--accent);border:2px solid var(--accent)}
  .game-area{margin-top:18px;display:flex;gap:18px}
  .left{
    flex:1;min-height:420px;
    background:linear-gradient(180deg,#fffdf8,#fff7ee);
    border-radius:12px;padding:12px;position:relative;overflow:hidden
  }
  .right{width:320px}
  .hud{position:absolute;top:12px;left:12px;display:flex;gap:8px;align-items:center}
  .score,.timer{
    background:rgba(255,255,255,0.7);padding:8px 10px;
    border-radius:10px;font-weight:800
  }
  .timer{font-weight:700}

  .target{
    position:absolute;cursor:pointer;touch-action:none;border-radius:12px;
    user-select:none;display:flex;align-items:center;justify-content:center;
    overflow:hidden;border:4px solid rgba(255,255,255,0.9);
    box-shadow:0 8px 20px rgba(0,0,0,0.15)
  }
  .target img{display:block;width:100%;height:100%;object-fit:cover}

  .right .card{margin-bottom:12px}
  .uploads{display:flex;gap:8px;flex-wrap:wrap}
  .thumb{
    width:72px;height:72px;border-radius:10px;overflow:hidden;
    border:2px dashed #eee;display:flex;align-items:center;
    justify-content:center;background:#fff
  }
  input[type=file]{display:none}

  .footer{margin-top:14px;font-size:13px;color:var(--muted)}
  .big-msg{margin-top:10px;padding:12px;border-radius:10px;
    background:linear-gradient(90deg,#ffefef,#fff9e6);font-weight:700}

  /* ---------- –∞–¥–∞–ø—Ç–∞—Ü–∏—è ---------- */
  @media(max-width:840px){
    body{padding:12px}
    .wrap{padding:16px}
    .game-area{flex-direction:column}
    .right{width:100%}
    .left{min-height:360px}
  }

  @media(max-width:600px){
    h1{font-size:18px}
    .lead{font-size:14px}
    .controls{
      flex-direction:column;
      gap:10px;
    }
    .card{
      padding:10px;
    }
    button,select{
      font-size:16px;
      padding:12px;
      width:100%;
    }
    .logo{
      width:52px;height:52px;font-size:18px;
    }
    .right .card strong{font-size:16px}
    .uploads{justify-content:center}
    .thumb{width:64px;height:64px}
    .score,.timer{
      font-size:16px;
      padding:6px 8px;
    }
    .footer{
      font-size:12px;
      text-align:center;
      margin-top:20px;
    }
    .big-msg{
      font-size:14px;
      text-align:center;
    }
  }

  @media(max-width:400px){
    body{padding:8px}
    .wrap{padding:12px}
    .left{min-height:300px}
    .thumb{width:60px;height:60px}
    button,select{font-size:15px}
  }
</style>

</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">üéà</div>
      <div>
        <h1>–ü–æ–π–º–∞–π –ò–Ω—Å–∞—Ä–∞</h1>
        <p class="lead">–í–µ—Å—ë–ª–∞—è –º–∏–Ω–∏-–∏–≥—Ä–∞-–æ—Ç–∫—Ä—ã—Ç–∫–∞ –¥–ª—è –¥—Ä—É–≥–∞ ‚Äî –ø–æ–π–º–∞–π –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –∫–ª–∏–∫–æ–≤ –Ω–∞ —Ñ–æ—Ç–æ –ò–Ω—Å–∞—Ä–∞!</p>
      </div>
    </header>

    <div class="controls">
      <label class="card" style="display:flex;align-items:center;gap:8px;">
        <input id="fileInput" type="file" accept="image/*" multiple>
        <button type="button" id="uploadBtn" class="secondary">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –ò–Ω—Å–∞—Ä–∞</button>
        <small style="color:var(--muted);font-weight:600">(–º–æ–∂–Ω–æ 1‚Äì6 —Ñ–æ—Ç–æ)</small>
      </label>

      <div class="card" style="display:flex;gap:8px;align-items:center">
        <label>–í—Ä–µ–º—è —Ä–∞—É–Ω–¥–∞:
          <select id="duration">
            <option value="20">20 —Å–µ–∫</option>
            <option value="30" selected>30 —Å–µ–∫</option>
            <option value="45">45 —Å–µ–∫</option>
            <option value="60">60 —Å–µ–∫</option>
          </select>
        </label>
        <label>–†–∞–∑–º–µ—Ä —Ü–µ–ª–∏:
          <select id="size">
            <option value="90">–ë–æ–ª—å—à–æ–π</option>
            <option value="70" selected>–°—Ä–µ–¥–Ω–∏–π</option>
            <option value="50">–ú–∞–ª–µ–Ω—å–∫–∏–π</option>
          </select>
        </label>
      </div>

      <div class="card" style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <button id="startBtn">–°—Ç–∞—Ä—Ç</button>
        <button id="resetBtn" class="secondary">–°–±—Ä–æ—Å</button>
      </div>
    </div>

    <div class="game-area">
      <div class="left card" id="playArea">
        <div class="hud">
          <div class="score" id="score">–û—á–∫–∏: 0</div>
          <div class="timer" id="timer">00:30</div>
        </div>

        <!-- –º–µ—Å—Ç–æ –¥–ª—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ (canvas) -->
        <canvas id="confettiCanvas" style="position:absolute;inset:0;pointer-events:none"></canvas>

        <div class="big-msg" id="message">–ù–∞–∂–º–∏ ¬´–°—Ç–∞—Ä—Ç¬ª, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –ò–Ω—Å–∞—Ä–∞ ‚Äî –∏ –ª–æ–≤–∏—Ç–µ –µ–≥–æ –∫–ª–∏–∫–∞–º–∏! –ò–º—è: <span style="color:var(--accent);">–ò–Ω—Å–∞—Ä</span></div>

      </div>

      <div class="right">
        <div class="card">
          <strong>–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ</strong>
          <div class="uploads" id="thumbs">
            <!-- –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
          </div>
          <small style="display:block;margin-top:8px;color:var(--muted)">–ö–ª–∏–∫ –ø–æ –ø—Ä–µ–≤—å—é ‚Äî —É–¥–∞–ª–∏—Ç—å.</small>
        </div>

        <div class="card">
          <strong>–ü—Ä–∞–≤–∏–ª–∞</strong>
          <ol style="margin:8px 0 0 18px;color:var(--muted)">
            <li>–ù–∞–∂–∏–º–∞–π –Ω–∞ –¥–≤–∏–∂—É—â—É—é—Å—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –ò–Ω—Å–∞—Ä–∞ ‚Äî –ø–æ–ª—É—á–∞–µ—à—å –æ—á–∫–∏.</li>
            <li>–¶–µ–ª—å –±—É–¥–µ—Ç —É—Å–∫–æ–ª—å–∑–∞—Ç—å –æ—Ç –∫—É—Ä—Å–æ—Ä–∞ ‚Äî —Å–ª–æ–∂–Ω–µ–µ, –Ω–æ –≤–µ—Å–µ–ª–µ–µ.</li>
            <li>–ó–∞ –∫–∞–∂–¥—ã–π —É–¥–∞—á–Ω—ã–π –∫–ª–∏–∫ ‚Äî +1 –æ—á–∫–æ. –ß–µ–º –º–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä ‚Äî —Ç–µ–º —Ü–µ–Ω–Ω–µ–µ (–≤ –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å).</li>
          </ol>
        </div>

        <div class="card">
          <strong>–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</strong>
          <div id="best" style="font-size:20px;margin-top:6px;font-weight:800">0 –æ—á–∫–æ–≤</div>
        </div>

      </div>
    </div>

    <div class="footer">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π –Ω–∞ —ç—Ç–æ—Ç —Ñ–∞–π–ª ‚Äî –¥—Ä—É–∑—å—è —Å–º–æ–≥—É—Ç —Å—ã–≥—Ä–∞—Ç—å –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ß—Ç–æ–±—ã –∑–∞–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ –ò–Ω—Å–∞—Ä–∞ ‚Äî –Ω–∞–∂–º–∏—Ç–µ ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ¬ª –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–∏ —Ñ–∞–π–ª—ã.</div>
  </div>

  <script>
    // --- –±–∞–∑–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ ---
    const fileInput = document.getElementById('fileInput');
    const uploadBtn = document.getElementById('uploadBtn');
    const thumbs = document.getElementById('thumbs');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const playArea = document.getElementById('playArea');
    const scoreEl = document.getElementById('score');
    const timerEl = document.getElementById('timer');
    const message = document.getElementById('message');
    const bestEl = document.getElementById('best');
    const confettiCanvas = document.getElementById('confettiCanvas');

    const durationSelect = document.getElementById('duration');
    const sizeSelect = document.getElementById('size');

    let images = []; // data URLs
    let target = null;
    let score = 0;
    let best = Number(localStorage.getItem('catchInsarBest') || 0);
    bestEl.textContent = best + ' –æ—á–∫–æ–≤';

    // placeholder SVG person if no image
    const placeholder = `data:image/svg+xml;utf8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="100%" height="100%" fill="%23ffd93d"/><g transform="translate(40,20)"> <circle cx="60" cy="40" r="26" fill="%23ff6b6b"/> <rect x="30" y="78" width="60" height="80" rx="18" fill="%23ff6b6b"/></g></svg>')}`;

    // handle upload
    uploadBtn.addEventListener('click', ()=>fileInput.click());
    fileInput.addEventListener('change', ev=>{
      const files = Array.from(ev.target.files).slice(0,6);
      files.forEach(f=>{
        const reader = new FileReader();
        reader.onload = e=>{
          images.push(e.target.result);
          renderThumbs();
        }
        reader.readAsDataURL(f);
      });
      fileInput.value = '';
    });

    function renderThumbs(){
      thumbs.innerHTML='';
      images.forEach((src,i)=>{
        const d = document.createElement('div'); d.className='thumb';
        const img = document.createElement('img'); img.src=src; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover';
        d.appendChild(img);
        d.addEventListener('click', ()=>{ images.splice(i,1); renderThumbs(); });
        thumbs.appendChild(d);
      });
      if(images.length===0){
        const d = document.createElement('div'); d.className='thumb'; d.innerHTML='<small style="text-align:center;color:#999">–ü—É—Å—Ç–æ</small>';
        thumbs.appendChild(d);
      }
    }

    renderThumbs();

    // create target element
    function makeTarget(sizePx){
      removeTarget();
      const el = document.createElement('div');
      el.className='target';
      el.style.width = sizePx+'px'; el.style.height = sizePx+'px';
      const img = document.createElement('img');
      img.src = images.length? images[Math.floor(Math.random()*images.length)] : placeholder;
      el.appendChild(img);
      playArea.appendChild(el);
      target = el;

      // click handler
      el.addEventListener('click', ev=>{
        ev.stopPropagation();
        registerHit();
      });

      return el;
    }

    function removeTarget(){ if(target){ target.remove(); target=null; } }

    // movement & AI
    let moving = false;
    let moveInterval = null;
    let avoidMouse = true;

    function startMoving(){
      moving = true;
      const areaRect = playArea.getBoundingClientRect();
      if(moveInterval) clearInterval(moveInterval);
      moveInterval = setInterval(()=>{
        if(!target) return;
        // decide new position
        const sizePx = parseInt(getComputedStyle(target).width);
        const padding = 8;
        const maxX = areaRect.width - sizePx - padding;
        const maxY = areaRect.height - sizePx - padding;
const offset = 100;
let nx = offset + Math.random() * (maxX - offset * 2);
let ny = offset + Math.random() * (maxY - offset * 2) + playArea.scrollTop;

        // if mouse is near, try to move away from it
        if(lastMouse){
          const mx = lastMouse.x - areaRect.left;
          const my = lastMouse.y - areaRect.top;
          const dx = (nx - mx), dy = (ny - my);
          const dist = Math.hypot(dx,dy);
          if(dist < 150){ // too close -> jump opposite
            nx = Math.min(Math.max(mx + ( (mx-nx) * 2.0 ), padding), maxX);
            ny = Math.min(Math.max(my + ( (my-ny) * 2.0 ), padding), maxY);
          }
        }
        target.style.transition = 'transform 340ms cubic-bezier(.2,.8,.2,1)';
        target.style.transform = `translate(${nx}px, ${ny}px)`;

        // occasionally change image
        if(Math.random()<0.15){
          const img = target.querySelector('img');
          img.src = images.length? images[Math.floor(Math.random()*images.length)] : placeholder;
        }
      }, 500);
    }

    function stopMoving(){ moving=false; if(moveInterval) clearInterval(moveInterval); moveInterval=null; }

    // mouse tracking
    let lastMouse = null;
    document.addEventListener('mousemove', e=>{ lastMouse = {x:e.clientX,y:e.clientY}; });
    document.addEventListener('touchmove', e=>{ const t=e.touches[0]; lastMouse={x:t.clientX,y:t.clientY}; }, {passive:true});

    // game state
    let gameTimer = null;
    let timeLeft = 30;

    function registerHit(){
      score += 1;
      scoreEl.textContent = '–û—á–∫–∏: '+score;
      spawnConfettiAt(target);
      // quick image flash/change
      const img = target.querySelector('img');
      img.style.transform='scale(0.9)';
      setTimeout(()=>img.style.transform='',120);
      // change position immediately
      // reposition instantly
      const areaRect = playArea.getBoundingClientRect();
      const sizePx = parseInt(getComputedStyle(target).width);
      const padding = 8;
      const maxX = areaRect.width - sizePx - padding;
      const maxY = areaRect.height - sizePx - padding;
const offset = 100;
const nx = offset + Math.random() * (maxX - offset * 2);
const ny = offset + Math.random() * (maxY - offset * 2) + playArea.scrollTop;


      target.style.transition='transform 160ms ease-out';
      target.style.transform = `translate(${nx}px, ${ny}px)`;
    }

    function startGame(){
      score = 0; scoreEl.textContent='–û—á–∫–∏: 0';
      const dur = parseInt(durationSelect.value);
      timeLeft = dur; timerEl.textContent = formatTime(timeLeft);
      // create target
      const sizePx = parseInt(sizeSelect.value);
      makeTarget(sizePx);
      // position target randomly (transform)
      const areaRect = playArea.getBoundingClientRect();
const offset = 100; // –æ—Ç—Å—Ç—É–ø –æ—Ç –∫—Ä–∞—ë–≤
const nx = offset + Math.random() * (areaRect.width - sizePx - offset * 2 - 8);
const ny = offset + Math.random() * (areaRect.height - sizePx - offset * 2 - 8) + playArea.scrollTop;


      target.style.transform = `translate(${nx}px, ${ny}px)`;
      startMoving();

      // timer
      if(gameTimer) clearInterval(gameTimer);
      gameTimer = setInterval(()=>{
        timeLeft -= 1;
        timerEl.textContent = formatTime(timeLeft);
        if(timeLeft<=0){ endGame(); }
      },1000);

      // update message
      message.textContent = '–ò–≥—Ä–∞ –∏–¥—ë—Ç! –õ–æ–≤–∏ –ò–Ω—Å–∞—Ä–∞ ‚Äî –∫–ª–∏–∫–∞–π –ø–æ —Ñ–æ—Ç–æ.';
    }

    function endGame(){
      stopMoving();
      clearInterval(gameTimer); gameTimer=null;
      removeTarget();
      message.textContent = `–†–∞—É–Ω–¥ –æ–∫–æ–Ω—á–µ–Ω! –ù–∞–±—Ä–∞–Ω–æ ${score} –æ—á–∫–æ–≤. –•–æ—á–µ—à—å –ø–æ–≤—Ç–æ—Ä?`;
      if(score>best){ best=score; localStorage.setItem('catchInsarBest', best); bestEl.textContent = best+' –æ—á–∫–æ–≤'; }
    }

    function resetGame(){ stopMoving(); clearInterval(gameTimer); gameTimer=null; score=0; scoreEl.textContent='–û—á–∫–∏: 0'; timerEl.textContent='00:00'; removeTarget(); message.textContent='–ù–∞–∂–º–∏ ¬´–°—Ç–∞—Ä—Ç¬ª, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –ò–Ω—Å–∞—Ä–∞ ‚Äî –∏ –ª–æ–≤–∏—Ç–µ –µ–≥–æ –∫–ª–∏–∫–∞–º–∏! –ò–º—è: –ò–Ω—Å–∞—Ä'; }

    startBtn.addEventListener('click', ()=>{ startGame(); });
    resetBtn.addEventListener('click', ()=>{ resetGame(); });

    function formatTime(sec){ const m = Math.floor(sec/60); const s = sec%60; return (m?m+':':'00:') + String(s).padStart(2,'0'); }

    // confetti (simple)
    const confettiCtx = confettiCanvas.getContext('2d');
    let confettiPieces = [];
    function resizeCanvas(){ confettiCanvas.width = playArea.clientWidth; confettiCanvas.height = playArea.clientHeight; }
    window.addEventListener('resize', resizeCanvas); resizeCanvas();

    function spawnConfettiAt(el){
      const rect = el.getBoundingClientRect();
      const areaRect = playArea.getBoundingClientRect();
      const x = rect.left - areaRect.left + rect.width/2;
      const y = rect.top - areaRect.top + rect.height/2;
      for(let i=0;i<18;i++){
        confettiPieces.push({x,y,vx:(Math.random()-0.5)*6,vy:(Math.random()*-6)-2,rot:Math.random()*360, size:6+Math.random()*8, life:60+Math.random()*40});
      }
      if(!confettiLoopRunning) runConfettiLoop();
    }

    let confettiLoopRunning=false;
    function runConfettiLoop(){ confettiLoopRunning=true; function step(){ confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); for(let i=confettiPieces.length-1;i>=0;i--){ const p=confettiPieces[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=0.25; p.rot+=3; p.life--; confettiCtx.save(); confettiCtx.translate(p.x,p.y); confettiCtx.rotate(p.rot*Math.PI/180); confettiCtx.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.6); confettiCtx.restore(); if(p.life<=0 || p.y>confettiCanvas.height+50) confettiPieces.splice(i,1); }
      if(confettiPieces.length>0) requestAnimationFrame(step); else { confettiLoopRunning=false; confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); } }
      requestAnimationFrame(step);
    }

    // allow clicking the play area to create small distraction (optional)
    playArea.addEventListener('click', e=>{
      // small pop
    });

    // initialize
    renderThumbs();

    // small helpful hint: allow dropping images onto the page
    ;(function setupDrop(){
      const overlay = document.createElement('div');
      overlay.style.position='absolute';overlay.style.inset='0';overlay.style.zIndex=2;overlay.style.pointerEvents='none';playArea.appendChild(overlay);
      ['dragenter','dragover'].forEach(ev=>{
        playArea.addEventListener(ev, e=>{ e.preventDefault(); overlay.style.pointerEvents='auto'; overlay.style.background='rgba(255,255,255,0.02)'; });
      });
      ['dragleave','drop'].forEach(ev=>{
        playArea.addEventListener(ev, e=>{ e.preventDefault(); overlay.style.pointerEvents='none'; overlay.style.background='transparent'; });
      });
      playArea.addEventListener('drop', e=>{
        const f = e.dataTransfer.files && e.dataTransfer.files[0];
        if(f && f.type.startsWith('image/')){
          const reader = new FileReader(); reader.onload=e2=>{ images.push(e2.target.result); renderThumbs(); }; reader.readAsDataURL(f);
        }
      });
    })();

    // prevent accidental selection while playing
    document.addEventListener('selectstart', e=>{ if(gameTimer) e.preventDefault(); });


        // --- –∑–≤—É–∫ –∫–ª–∏–∫–∞ ---
// –ü–æ–¥–∫–ª—é—á–∞–µ–º –∑–≤—É–∫ –∏–∑ —Ñ–∞–π–ª–∞ –≤ –ø–∞–ø–∫–µ —Å index.html
const clickSound = new Audio("click.mp3");

function playClickSound() {
  const snd = clickSound.cloneNode(); // –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –∑–≤—É–∫
  snd.volume = 0.5;
  snd.play().catch(() => {});
}

// –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–∑–æ–≤ –∑–≤—É–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ò–Ω—Å–∞—Ä–∞
const oldRegisterHit = registerHit;
registerHit = function() {
  playClickSound();
  oldRegisterHit();
};


  </script>
</body>
</html>
